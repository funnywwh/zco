# ZCO v0.6.0 版本发布说明

## 概述

ZCO v0.6.0 是一个优化版本，主要改进了 ucontext 实现的架构设计，提升了上下文切换的性能和代码可维护性。

## 🚀 主要更新

### ucontext 实现架构优化

**核心改进**: 移除 ucontext 实现中的信号屏蔽处理逻辑，由调用者（调度器层）统一管理信号掩码。

#### 技术细节

1. **`getcontext` 函数优化**
   - **之前**: 调用 `pthread_sigmask` 保存当前信号掩码到 `uc_sigmask`
   - **现在**: 仅清零 `uc_sigmask` 字段，不再进行系统调用
   - **优势**: 减少系统调用开销，信号掩码由调用者根据需求设置

2. **`setcontext` 函数优化**
   - **之前**: 调用 `pthread_sigmask` 恢复信号掩码
   - **现在**: 移除信号掩码恢复逻辑
   - **优势**: 避免重复的信号操作，调用者在适当时机处理信号

3. **架构优势**
   - **职责分离**: 上下文切换只负责寄存器保存/恢复，信号处理由调度器层统一管理
   - **性能提升**: 减少不必要的系统调用，降低上下文切换开销
   - **代码清晰**: 信号处理逻辑集中在调度器的 `blockPreemptSignals`/`restoreSignals` 函数中

## 📊 性能影响

- **上下文切换开销**: 减少 2 次系统调用（`pthread_sigmask`）
- **代码路径**: 更简洁的执行路径，减少分支判断
- **架构清晰**: 职责划分更明确，便于后续优化

## 🔄 向后兼容性

✅ **完全兼容**: API 接口未改变，现有代码无需修改即可使用

✅ **行为一致**: 功能行为与 v0.5.0 完全一致，只是内部实现优化

## 📚 文档更新

- ✅ 更新了 `README.md` 版本信息和特性说明
- ✅ 更新了 `docs/CHANGELOG.md` 变更日志
- ✅ 更新了 `docs/UCONTEXT_IMPLEMENTATION.md` 实现文档
- ✅ 添加了版本历史记录

## 🧪 测试验证

- ✅ 编译通过，无错误和警告
- ✅ 代码架构改进验证
- ✅ 向后兼容性验证

## 📦 升级指南

### 从 v0.5.0 升级

无需任何代码修改，直接使用新版本即可：

```bash
git checkout 0.6.0
zig build
```

### 依赖检查

- Zig 版本: 0.14.0+
- 依赖库: libxev
- 平台: x86_64 Linux

## 🔮 未来计划

基于这次架构优化，未来可以进一步：

1. **性能优化**: 利用更清晰的架构进行更深度的性能优化
2. **平台扩展**: 更容易扩展到其他架构（ARM64 等）
3. **功能增强**: 添加更多上下文切换相关的优化

## 📝 贡献者

感谢所有为 ZCO 项目做出贡献的开发者。

## 🔗 相关链接

- [完整变更日志](../CHANGELOG.md)
- [ucontext 实现文档](./UCONTEXT_IMPLEMENTATION.md)
- [项目 README](../README.md)

---

**发布日期**: 2024-12-31  
**版本**: 0.6.0  
**类型**: 优化版本

